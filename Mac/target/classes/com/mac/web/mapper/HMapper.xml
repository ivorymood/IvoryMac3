<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mac.web.mapper.HMapper">
<resultMap type="java.util.HashMap" id="itemMap">
	<id property="itemSeq" column="item_seq" />
	<result property="itemName" column="item_name"/>
	<result property="itemStock" column="item_stock"/>
	<result property="colorExp" column="color_exp"/>
	<result property="textureExp" column="texture_exp"/>
	<result property="picName" column="pic_name"/>
	<result property="itemCode" column="item_code"/>
	<result property="commonName" column="common_name"/>
	<result property="commonExp" column="common_exp"/>
	<result property="price" column="price"/>
	<result property="discount" column="discount"/>
	<result property="detailInfo" column="detail_info"/>
	<result property="ingredient" column="ingredient"/>
	<result property="weight" column="weight"/>
</resultMap>
<resultMap type="java.util.HashMap" id="test">
	<id property="itemSeq" column="item_seq" />
	<result property="itemStock" column="item_stock"/>
	<result property="colorExp" column="color_exp"/>
	<result property="textureExp" column="texture_exp"/>
	<result property="picName" column="pic_name"/>
	<result property="itemCode" column="item_code"/>
</resultMap>
<resultMap type="java.util.HashMap" id="itemInfo">
	<id property="rownum" column="rownum"/>
	<result property="classCode" column="classCode"/>
	<result property="className" column="className"/>
	<result property="itemName" column="itemName"/>
	<result property="commonName" column="commonName"/>
	<result property="commonNameE" column="commonNameE"/>
	<result property="textureExp" column="textureExp"/>
	<result property="itemCount" column="itemCount"/>
	<result property="price" column="price"/>
	<result property="discount" column="discount"/>
	<result property="picName" column="picName"/>
	<result property="itemCode" column="itemCode"/>
	<result property="itemSeq" column="itemSeq"/>
	<result property="colorExp" column="colorExp"/>
	<result property="discountPrice" column="discountPrice"/>
	<result property="kindCount" column="kindCount"/>
	<result property="total" column="total"/>
	<result property="eachTotal" column="eachTotal"/>
	<result property="basketSeq" column="basketSeq"/>
	<result property="addrSeq" column="addrSeq"/>
	<result property="orderSeq" column="orderSeq"/>
	<result property="discountedTotal" column="discountedTotal"/>
	<result property="discountAmount" column="discountAmount"/>
</resultMap>
<select id="selectSubMainItems" parameterType="hashMap" resultMap="itemInfo">
select tmp.*, 
		i.pic_name as picName
from item i, (select 
			c.item_code as itemCode,
			c.common_name as commonName, 
			c.common_name_e as commonNameE,
			c.price *(1- c.discount) as discountPrice,
			(select t.item_seq
			from item t
			where t.item_code like c.item_code
			order by t.item_seq limit 1) as itemSeq,
			(select count(*)
			from item i
			where i.item_code like c.item_code) as kindCount
from common_feature c
where c.class_code like #{classCode}) tmp
where i.item_seq like tmp.itemSeq;

</select>
<select id="selectFirstItem" parameterType="hashMap" resultMap="itemInfo"><!-- 아직안씀 -->
select item_seq as itemSeq
from item
where item_code like #{itemCode}
order by itemSeq limit 1;

</select>
<select id="findByItemSeq" parameterType="hashMap" resultMap="test">
	select * 
	from item
	where item_seq like ${itemSeq}; 
</select>

<select id="findByItemCodenItemSeq" parameterType="hashMap" resultMap="itemMap">
	select i.item_seq,
		i.item_name,
		i.item_stock,
		i.color_exp,
		i.texture_exp,
		i.pic_name,
		c.item_code,
		c.common_name,
		c.common_exp,
		c.price,
		c.discount,
		c.detail_info,
		c.ingredient,
		c.weight
	from item i, common_feature c
	where i.item_seq like ${itemSeq}
		and c.item_code like #{itemCode};
</select>
<insert id="insertBasket" parameterType="HashMap">
	insert into basket(custom_id, item_seq, item_code, item_count)
	values('kim', ${itemSeq}, #{itemCode}, 1);
</insert>
</mapper>